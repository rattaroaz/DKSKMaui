<!DOCTYPE html>
<html>
<head>
    <title>Test Sales PDF Generation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <h1>Test Sales PDF Generation</h1>

    <br>
    <button onclick="testSalesPDF()">Test Sales PDF Generation</button>

    <script>
        // Copy the functions from index.html
        window.setPdfData = (data) => {
            console.log('Setting PDF data:', data);
            window.pdfData = data;
        };

        window.saveAsPDFFallback = (templateID, filename, isLandscape = false) => {
            console.log('saveAsPDFFallback called');
            console.log('Available window.pdfData:', window.pdfData);

            try {
                if (!window.pdfData || !Array.isArray(window.pdfData) || window.pdfData.length === 0) {
                    console.error('No PDF data available for fallback generation');
                    alert('No data available for PDF generation. Please ensure there is data to export.');
                    return;
                }

                const { jsPDF } = window.jspdf;
                const orientation = isLandscape ? 'landscape' : 'portrait';
                const doc = new jsPDF({
                    orientation: orientation,
                    unit: 'mm',
                    format: 'a4'
                });

                // Create table from data
                const data = window.pdfData;
                const columns = Object.keys(data[0] || {});
                const rows = data.map(obj => Object.values(obj));

                // Add title
                doc.setFontSize(16);
                doc.text(filename.replace(/_/g, ' ').toUpperCase(), 14, 20);

                // Add timestamp
                doc.setFontSize(10);
                doc.text(`Generated on: ${new Date().toLocaleString()}`, 14, 30);

                // Create table
                doc.autoTable({
                    head: [columns],
                    body: rows,
                    startY: 40,
                    styles: {
                        fontSize: 8,
                        cellPadding: 2
                    },
                    headStyles: {
                        fillColor: [41, 128, 185],
                        textColor: 255
                    },
                    alternateRowStyles: {
                        fillColor: [245, 245, 245]
                    }
                });

                doc.save(filename + '_fallback.pdf');

            } catch (error) {
                console.error('Fallback PDF generation also failed:', error);
            }
        };

        function testSalesPDF() {
            // Test with sample sales data
            const salesData = [
                {
                    InvoiceNumber: '10001',
                    WorkDate: '12/01/2023',
                    CompanyName: 'ABC Construction',
                    PropertyAddress: '123 Main St, Anytown, USA',
                    Unit: 'Unit A',
                    ContractorName: 'John Doe',
                    WorkOrder: 'WO-001',
                    JobDescription: 'Kitchen Renovation',
                    AmountCost: 2500.00,
                    AmountPaid1: 1250.00,
                    DatePaid1: '12/15/2023',
                    CheckNumber1: 'CHK-001',
                    AmountPaid2: 1250.00,
                    DatePaid2: '01/15/2024',
                    CheckNumber2: 'CHK-002'
                },
                {
                    InvoiceNumber: '10002',
                    WorkDate: '12/05/2023',
                    CompanyName: 'XYZ Builders',
                    PropertyAddress: '456 Oak Ave, Somewhere, USA',
                    Unit: 'Unit B',
                    ContractorName: 'Jane Smith',
                    WorkOrder: 'WO-002',
                    JobDescription: 'Bathroom Remodel',
                    AmountCost: 1800.00,
                    AmountPaid1: 1800.00,
                    DatePaid1: '12/20/2023',
                    CheckNumber1: 'CHK-003',
                    AmountPaid2: 0.00,
                    DatePaid2: '01/01/1900',
                    CheckNumber2: ''
                }
            ];

            window.setPdfData(salesData);
            window.saveAsPDFFallback('sales_data', 'Sales_Summary_2_invoices', true);
        }
    </script>
</body>
</html>
